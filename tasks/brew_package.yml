## https://github.com/Homebrew/homebrew-core/issues/4204
#- name: Force brew update
#  shell: "cd $({{brew_dir}}/bin/brew  --repo); /usr/bin/git fetch; /usr/bin/git reset --hard origin/master; {{brew_dir}}/bin/brew update"
#  sudo: yes
#  sudo_user: sw-installer

- name: Check {{brew_name}} installed
  shell: "{{brew_dir}}/bin/brew list {{brew_name}}"
  register: exists
  ignore_errors: True


- name: Install {{brew_name}}
  shell: "{{brew_dir}}/bin/brew install {{brew_name}}"
  when: exists.rc == 1

- name: Create module def
  shell: "{{brew_dir}}/brew2lmod.rb -l '{{libdir | default('')}}' -m {{modules_dir}}/bio -b {{brew_dir}}/bin/brew {{lmod_name}}"
  when: exists.rc == 1
