---

- name: check CRAN R script exists
  stat:
    path: "{{ playbook_dir }}/scripts/R/{{ item }}"
  with_items:
      - cran.R
      - bioconductor.R
  delegate_to: localhost
  become: false
  register: e

  tags: r-extras

- file:
    dest: "{{ tmp_dir }}/scripts/R"
    state: directory
    mode: 0755
  with_items: "{{ e.results }}"
  when: item.stat.exists
  
  tags: r-extras

- name: copy R script {{ tmp_dir }}
  copy:
    src: "{{ playbook_dir }}/scripts/R/{{ item.item }}"
    dest: "{{ tmp_dir }}/scripts/R"
  with_items: "{{ e.results }}"
  when: item.stat.exists

  tags: r-extras

- name: run CRAN R script to install packages
  shell: Rscript {{ tmp_dir }}/scripts/R/{{ item.item }} {{ r_base_mirror }}
  with_items: "{{ e.results }}"
  when: item.stat.exists

  tags: r-extras

#TODO add clean up of scripts/R directory
