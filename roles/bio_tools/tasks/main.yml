---
- name: Find Python3 version
  tags: ["always", "python"]
  command: "{{ python3_executable }} --version"
  register: python3_v_str

- name: Debug find python3 version
  debug: 
    msg: "{{ python3_v_str.stdout }}" 
  tags: ["always", "python"]

# Python 3.x prints --version to stdout
- name: Extract Python3 major version (ie 3.4, 3.5, 3.6)
  tags: ["always", "python"]
  set_fact: python3_version_major_minor="{{ python3_v_str.stdout.split()[1].rsplit('.', 1)[0] }}"

- name: Find Python2 version
  tags: ["always", "python"]
  command: "{{ python2_executable }} --version"
  register: python2_v_str

- name: Debug find python2 version
  debug:
    msg: "{{ python2_v_str.stderr }}" 
  tags: ["always", "python"]

# Python 2.x prints --version to stderr (not stdout like Python 3.x !)
- name: Extract Python2 major version (ie 2.6, 2.7)
  tags: ["always", "python"]
  set_fact: python2_version_major_minor="{{ python2_v_str.stderr.split()[1].rsplit('.', 1)[0] }}"

- name: Set conda executable path
  tags: ["always"]
  set_fact: conda_bin={{ apps_dir }}/conda/bin/conda

- include: conda.yml

- include: star.yml version={{ star_version}}
- include: bwa.yml version={{ bwa_version }} 
- include: bowtie2.yml version={{ bowtie2_version }} 
- include: htslib.yml version={{ htslib_version }}
- include: samtools.yml version={{ samtools_version }} htslib_v={{ htslib_version }}
- include: bcftools.yml version={{ bcftools_version }} htslib_v={{ htslib_version }}
- include: subread.yml version={{ subread_version }}
- include: picard.yml version={{ picard_version }}
- include: gatk.yml version={{ gatk_version }}
- include: fastqc.yml version={{ fastqc_version }}
- include: sratoolkit.yml version={{ sratoolkit_version }}
- include: rnasik-pipe.yml version={{ rnasik_version }}
- include: qualimap.yml version={{ qualimap_version }}
- include: seqtk.yml version={{ seqtk_version }}
- include: igv.yml version={{ igv_version }}
- include: bedtools.yml version={{ bedtools2_version }}
- include: blast.yml version={{ blast_version }}
- include: smalt.yml version={{ smalt_version }}
  #- include: bcl2fastq2.yml version={{ bcl2fastq2_version }}
- include: emboss.yml version={{ emboss_version }}
# Python-based
- include: mimodd.yml version={{ mimodd_version }}
- include: multiqc.yml version={{ multiqc_version }}
- include: cutadapt.yml version={{ cutadapt_version }}
- include: macs2.yml version={{ macs2_version }}
- include: qiime.yml version={{ qiime_version }}
#
- include: snpeff.yml version={{ snpeff_version }}
- include: spades.yml version={{ spades_version }}
- include: vsearch.yml version={{ vsearch_version }}
- include: raxml.yml version={{ raxml_version }}
- include: cellranger.yml version={{ cellranger_version }}
- include: vcftools.yml version={{ vcftools_version }}
- include: biotradis.yml version={{ biotradis_version }}
- include: bioperl.yml version={{ bioperl_version }}
- include: muscle.yml version={{ muscle_version }}
- include: cdhit.yml version={{ cdhit_version }}
- include: mothur.yml version={{ mothur_version }}
- include: hifive.yml version={{ hifive_version }}
#- include: infernal.yml version={{ infernal_version }} # broken ? replaced by bioconda version

# List of Bioconda packages available: https://bioconda.github.io/recipes.html
- include_tasks: conda-package.yml package=gatk4 version={{ gatk4_version }}
  tags: gatk4
- include_tasks: conda-package.yml package=freebayes version={{ freebayes_version }}
  tags: freebayes
- include_tasks: conda-package.yml package=infernal version={{ infernal_version }}
  tags: infernal

# always install freebayes and vcflib last as they tend to break during compilation
# - include: freebayes.yml version={{ freebayes_version }} # replaced by bioconda version
- include: vcflib.yml version={{ vcflib_version }}
